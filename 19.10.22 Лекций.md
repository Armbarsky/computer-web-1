Характеристики системы DNS в глобальной сети Интернет
•	Распределённость администрирования
•	Распределённость хранения информации
•	Кеширование информации
•	Иерархическая структура
•	Резервирование

Механизмы разрешения имён
1.	Локальный для каждого компьютера файл hosts.
2.	Централизованная иерархическая служба имен DNS.
На начальном этапе развития сетей, когда количество узлов в каждой сети было небольшое, достаточно было на каждом компьютере хранить и поддерживать актуальное состояние простого текстового файла, в котором содержался список сетевых узлов данной сети. Список устроен очень просто - в каждой строке текстового файла содержится пара "IP-адрес - имя сетевого узла".
Сразу после установки операционной системы файл hosts создаётся с одной записью 127.0.0.1 localhost.
Местонахождение файла hosts:
В Linux: /etc/hosts
В Windows: %system root%\system32\drivers\etc\hosts (где %system root% обозначает папку, в которой установлена операционная система).
С ростом сетей поддерживать актуальность и точность информации в файле hosts становится все труднее. Для этого надо постоянно обновлять содержимое этого файла на всех узлах сети. Кроме того, такая простая технология не позволяет организовать пространство имен в какую-либо структуру. Поэтому появилась необходимость в централизованной базе данных имен, позволяющей производить преобразование имен в IP-адреса без хранения списка соответствия на каждом компьютере. Такой базой стала DNS (Domain Name System) - система именования доменов, которая начала массовую работу в 1987 году.
С появлением службы DNS актуальность использования файла host совсем не исчезла, в ряде случаев использование этого файла оказывается очень эффективным.
Системный вызов разрешения имён во всех ОС обычно реализован так: сначала проверяется локальный файл hosts, затем идёт обращение в службу имён DNS, прописанную локальных настройках ОС:
В Linux — в файле /etc/resolv.conf
В Windows — настройки адаптера→DNS→DNS серверы и DNS суффиксы.
Пример файла «example.com» зоны прямого разрешения:
@ IN SOA ns.example.com. root.example.com. (
95031802 ; Serial (yymmddxx)
10800 ; Refresh 3 hours
3600 ; Retry 1 hour
3600000 ; Expire 1000 hours
86400 ) ; Minimum 24 hours
@ IN NS ns.example.com.
@ IN NS ns2.example.com.
@ IN A 10.0.0.152
@ IN MX 5 mx.example.com.
ns IN A 10.0.0.152
ns2 IN A 10.0.0.191
mx IN A 10.0.0.152
www IN CNAME @
Пример файла "0.0.10.in-addr.arpa" зоны обратного разрешения:
@ IN SOA ns.examle.com. root.example.com. (
94102501 ; Serial
10800 ; Refresh 3 hours
3600 ; Retry 1 hour
3600000 ; Expire 1000 hours
86400 ) ; Minimum 24 hours
IN NS ns.examle.com.
IN NS ns2.example.com.
152 IN PTR example.com.
191 IN PTR ns.example.com.
* IN PTR example.com.
Пример подключения файлов зон (на примере BIND):
// подключение основной зоны
zone "example.com" {
type master;
file "example.com";
};
// подключение обратной зоны
zone "0.0.10.in-addr.arpa" {
type master;
file "0.0.10.in-addr.arpa";
};
Режимы работы DNS сервера (на примере BIND)
1. Кэширующий. Обрабатывает рекурсивные запросы, выполняет на ROOT серверах (файл /etc/root.hint). Необходима защита от DoS-атак.
Пример настройки:
acl goodclients { 192.0.2.0/24; localhost; localnets; };
options {
  recursion yes;
  allow-query { goodclients; };
};

2. Перенаправляющий. Перенаправляет все запросы на другие DNS-сервера, не пытаясь решить их, затем их кэширует. Меньше рабочая нагрузка.
Список серверов прописывается явно (пример настройки сервера BIND):
forwarders { 8.8.8.8; 8.8.4.4;};
options {
  forward only;
};
3. Авторитетный (первичный — master).
Пример подключения зоны прямого разрешения на первичном сервере (master) 10.0.0.152 с разрешением обмена со вторичным (slave) сервером 10.0.0.191:
zone "example.com" {
  type master;
  file "example.com";
  allow-transfer { 10.0.0.191; };
};
4. Авторитетный (вторичный — slave).
Пример подключения зоны прямого разрешения на вторичном (slave) сервере 10.0.0.191 с импортом этой зоны из первичного (master) сервера 10.0.0.152:
zone "example.com" {
  type slave;
  file "example.com";
  masters { 10.0.0.152; };
};
Типы запросов к DNS
1.	Рекурсивный и нерекурсивный. При рекурсивном выполняется от имени клиента полный поиск нужной информации во всей системе DNS, при необходимости обращаясь к другим DNS-серверам.
2.	Прямой и обратный DNS-запрос.


Утилиты для обращения к системе DNS
•	В Windows:
nslookup <имя или ip> [<DNS-сервер>]
•	В Linux:
host  {name} [server]
dig [@server] [name] [type]




Параметры, получаемые по DHCP
•	IP-адрес. Маска подсети.
•	Шлюзы по умолчанию.
•	Статические маршруты.
•	DNS-серверы.
•	Сервер синхронизации времени.
•	Смещение времени.
•	Настройки сервера загрузки – настройки протокола TFTP/BOOTP, необходимые для бездисковой загрузки хостов.
•	Списки доступных SMTP и POP серверов.
•	Настройки WINS и Netbios
•	Размер MTU, время жизни кэша ARP, размер TTL и др.


Алгоритм получения сетевых настроек через DHCP-сервер
 
1. Клиент посылает в свою подсеть широковещательное сообщение DHCPDISCOVER, в котором могут указываться устраивающие клиента IP-адрес и срок его аренды. В качестве IP-адреса источника указывается 0.0.0.0, в качестве адреса назначения - 255.255.255.255. Если DHCP-сервер отсутствует в подсети, то сообщение будет передано в другие подсети агентами протокола BOOTP.
2. Получив запрос от клиента, DHCP-сервер отвечает на него сообщением DHCPOFFER. В сообщение включается предлагаемый IP-адрес (yiaddr) и прочие конфигурации для клиента (адреса маршрутизаторов, DNS-серверов и т.д.). На данном этапе сервер не обязан резервировать адрес, который он отправил клиенту.
3. Получив конфигурации от серверов (их может быть несколько, если в подсети более одного DHCP-севрера), клиент отправляет широковещательное сообщение DHCPREQUEST. В нем содержатся идентификатор выбранного сервера и, возможно, желательные значения запрашиваемых параметров конфигурации. На данном этапе допускается, что клиента не устроит ни один из предложенных адресов, тогда он вновь отправит DHCPDISCOVER.
4. Получив DHCPREQUEST и убедившись, что в сообщении его идентификатор, сервер проверяет свободен ли в данный момент запрошенный адрес. Если да, то отправляет DHCPACK и вносит запись в базу, иначе отправляет DHCPNACK
5. Получив сообщение DHCPACK, клиент обязан убедиться в уникальности IP-адреса (средствами протокола ARP) и зафиксировать суммарный срок его аренды.
Срок аренды: время, прошедшее между отправкой сообщения DHCPREQUEST и приемом ответного сообщения DHCPACK + срок аренды, указанный в DHCPACK.
Если адрес уже используется другой станцией, клиент отправляет DHCPDECLINE и начинает всю процедуру снова.
6. Для досрочного прекращения аренды адреса клиент отправляет серверу сообщение DHCPRELEASE.

Настроить DNS-сервер на примере пакета Bind из состава операционной системы Debian или Ubuntu:
 
Начальные условия: необходимо создать виртуальную машину (ВМ) локально в VirtualBox. Для этого скачать образ Debian 11 и импортировать в VirtualBox. После импорта сделать снапшот с именем Clean.
Для входа в локальную систему VirtualBox необходимо использовать учётные данные:
username: root
password: P@ssw0rd
Также есть вариант для выполнения этой практической работы на облачных платформах Oracle Cloud или AWS. Создание облачных серверов описано в первом модуле.
